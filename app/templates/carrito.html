{% extends "base.html" %}

{% block title %}Carrito de Compras - ShopOnline{% endblock %}

{% block head %}
{{ super() }}
<script src="{{ url_for('static', filename='js/carrito.js') }}"></script>
{% endblock %}

{% block content %}
<div class="relative flex h-auto min-h-screen w-full flex-col bg-white group/design-root overflow-x-hidden" style='font-family: Inter, "Noto Sans", sans-serif;'>
    <div class="layout-container flex h-full grow flex-col">
        <div class="px-4 sm:px-6 lg:px-10 flex flex-1 justify-center py-5">
            <div class="layout-content-container flex flex-col max-w-4xl flex-1">
                <!-- Header -->
                <div class="flex flex-wrap justify-between gap-3 p-4">
                    <p class="text-[#111418] tracking-light text-[32px] font-bold leading-tight min-w-72">Carrito de Compras</p>
                </div>

                <!-- Items del Carrito -->
                <div id="carrito-items">
                    {% if carrito_items %}
                        {% for item in carrito_items %}
                        <div class="flex items-center gap-4 bg-white px-4 min-h-[72px] py-2 justify-between border-b border-[#f0f2f4]">
                            <div class="flex items-center gap-4 flex-1">
                                <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-lg size-14 bg-gray-200">
                                    {% if item.producto.imagen_url %}
                                        <img src="{{ item.producto.imagen_url }}" alt="{{ item.producto.nombre }}" class="w-full h-full object-cover rounded-lg">
                                    {% else %}
                                        <div class="w-full h-full flex items-center justify-center bg-gray-300 rounded-lg">
                                            <span class="text-gray-500 text-xs">Sin imagen</span>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="flex flex-col justify-center flex-1">
                                    <p class="text-[#111418] text-base font-medium leading-normal line-clamp-1">{{ item.producto.nombre }}</p>
                                    <p class="text-[#617589] text-sm font-normal leading-normal">S/ {{ "%.2f"|format(item.producto.precio) }}</p>
                                </div>
                            </div>
                            <div class="shrink-0">
                                <div class="flex items-center gap-2 text-[#111418]">
                                    <button class="text-base font-medium leading-normal flex h-7 w-7 items-center justify-center rounded-full bg-[#f0f2f4] cursor-pointer hover:bg-[#e0e2e4]"
                                            onclick="carritoActualizarCantidad({{ item.producto.id }}, -1)">-</button>
                                    <input
                                        class="text-base font-medium leading-normal w-8 p-0 text-center bg-transparent focus:outline-0 focus:ring-0 focus:border-none border-none [appearance:textfield] [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none"
                                        type="number"
                                        value="{{ item.cantidad }}"
                                        min="1"
                                        max="{{ item.producto.stock }}"
                                        onchange="carritoActualizarCantidadInput({{ item.producto.id }}, this.value)"
                                        id="cantidad-{{ item.producto.id }}"
                                    />
                                    <button class="text-base font-medium leading-normal flex h-7 w-7 items-center justify-center rounded-full bg-[#f0f2f4] cursor-pointer hover:bg-[#e0e2e4]"
                                            onclick="carritoActualizarCantidad({{ item.producto.id }}, 1)">+</button>
                                </div>
                                <button class="text-red-500 text-xs font-medium mt-1 hover:text-red-700"
                                        onclick="carritoEliminarProducto({{ item.producto.id }})">
                                    Eliminar
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                    <!-- Carrito vacÃ­o -->
                    <div class="text-center py-12">
                        <div class="text-[#617589] text-6xl mb-4">ðŸ›’</div>
                        <p class="text-[#617589] text-lg mb-4">Tu carrito estÃ¡ vacÃ­o</p>
                        <a href="{{ url_for('main.catalogo') }}" 
                           class="text-[#1380ec] hover:text-[#0d6ecb] font-medium">
                            Continuar comprando
                        </a>
                    </div>
                    {% endif %}
                </div>

                <!-- Resumen del Pedido -->
                {% if carrito_items %}
                <div class="mt-8">
                    <h3 class="text-[#111418] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2">Resumen del Pedido</h3>
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <div class="flex justify-between gap-x-6 py-2">
                            <p class="text-[#617589] text-sm font-normal leading-normal">Subtotal</p>
                            <p class="text-[#111418] text-sm font-normal leading-normal text-right" id="subtotal">S/ {{ "%.2f"|format(subtotal) }}</p>
                        </div>
                        <div class="flex justify-between gap-x-6 py-2">
                            <p class="text-[#617589] text-sm font-normal leading-normal">EnvÃ­o</p>
                            <p class="text-[#111418] text-sm font-normal leading-normal text-right" id="envio">S/ {{ "%.2f"|format(envio) }}</p>
                        </div>
                        <div class="flex justify-between gap-x-6 py-2">
                            <p class="text-[#617589] text-sm font-normal leading-normal">Impuestos</p>
                            <p class="text-[#111418] text-sm font-normal leading-normal text-right" id="impuestos">S/ {{ "%.2f"|format(impuestos) }}</p>
                        </div>
                        <div class="flex justify-between gap-x-6 py-2 border-t border-gray-200 mt-2 pt-3">
                            <p class="text-[#111418] text-base font-bold leading-normal">Total</p>
                            <p class="text-[#111418] text-base font-bold leading-normal text-right" id="total">S/ {{ "%.2f"|format(total) }}</p>
                        </div>
                    </div>
                </div>

                <!-- BotÃ³n de Checkout -->
                <div class="flex px-4 py-6">
                    <button
                        class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-5 flex-1 bg-[#1380ec] text-white text-base font-bold leading-normal tracking-[0.015em] hover:bg-[#0d6ecb] transition-colors"
                        onclick="carritoProcederCheckout()">
                        <span class="truncate">Proceder al Checkout</span>
                    </button>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Mensajes Flash -->
{% with messages = get_flashed_messages() %}
    {% if messages %}
        <div class="fixed top-20 right-4 z-50 space-y-2">
            {% for message in messages %}
                <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg shadow-lg">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}
{% endwith %}

{% endblock %}